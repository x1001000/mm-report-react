var ChartApp={sel_prefix:"",loggedObj:{},fetchingObj:{},ignoredCharts:[],limitedCharts:[],toggleAllSeries:function(e,a){let n;for(let t=0;t<Highcharts.charts.length;t++)if(void 0!==Highcharts.charts[t]&&Highcharts.charts[t].renderTo.id===e){n=Highcharts.charts[t];break}n&&Array.isArray(n.series)&&n.series.forEach(function(t){t.setVisible(a,!1)})},countStat:function(e){if(isNaN(parseInt(e))||e<1)return!1;$.ajax("/api/stat/count/"+e,{method:"POST",success:function(t){1===t.success&&console.log("count stat, stat_id:"+e)}})},likeCharts:function(t=""){$(t+".chart-like").on("click",function(t){if(!App.isUserLoggedIn())return App.trk4("prompt_login",{Campaign:"chart_like",url:location.pathname}),alert(App.__("user:pls-login")),void(location.href="/login?next="+location.pathname);var e=$(this),a=e.attr("id").split("-")[1];$.post("/shared_chart/like/"+a,{ts:App._now()},function(t){1===t.success&&void 0!==t.count&&$(".feedback-num",e).text(t.count)},"json")})},getStatData:function(t){0<t.length&&$.ajax("/stats/data/"+t.join(","),{success:function(t){for(var e in t.data)App.data[e]=t.data[e];ChartApp.drawVisibleStats()},headers:{Authorization:"Bearer "+App.stk,Docref:document.referrer},dataType:"json"})},preloadStats:function(t=""){let a=[];$(t+".stat-chart").each(function(t,e){e=$(e).data("stid");"s:"+e in App.data||isNaN(parseInt(e))||a.push(e)}),ChartApp.getStatData(a)},preloadCharts:function(t=""){let o=[];$(t+".chart").each(function(t,e){var a,n=$(e).data("chid");"c:"+n in App.data?(a=$(e).attr("id"),ChartApp.drawChart(a,n)):isNaN(parseInt(n))||$(e).hasClass("preloading")||($(e).addClass("preloading"),o.push(n))}),0<o.length&&ChartApp.getChartData(o).then(()=>{})},preloadQuickieCharts:function(t=""){let a=[];$(t+".quickie-body").each(function(t,e){$(e).hasClass("hidden")||($(e).find(".chart").each(function(t,e){$(e).data("chid")&&void 0===App.data["c:"+$(e).data("chid")]&&a.push($(e).data("chid"))}),$(e).addClass("expanded"))}),ChartApp.getChartData(a),$(".quickie-body").on("click",function(){let a=[];!$(this).hasClass("expanded")&&$(this).hasClass("hidden")&&($(this).find(".chart").each(function(t,e){$(e).data("chid")&&void 0===App.data["c:"+$(e).data("chid")]&&a.push($(e).data("chid"))}),$(this).addClass("expanded"),App.getChartData(a))})},getChartData:async function(e){let a=[];for(let t=0;t<e.length;t++)-1===a.indexOf(e[t])&&0!==parseInt(e[t])&&a.push(e[t]);"chart"in ChartApp.fetchingObj||(ChartApp.fetchingObj.chart=[]),(a=a.filter(function(t){return-1===ChartApp.fetchingObj.chart.indexOf(t)})).forEach(function(t){ChartApp.fetchingObj.chart.push(parseInt(t))}),await ChartApp.getMultiChartsLogView("chart",a),await new Promise(t=>{setTimeout(function(){t()},App._rand(500,1e3))});let o=[];for(;0<a.length;)o.push(a.splice(0,3));for(let n=0;n<o.length;n++){let t=o[n],e=0<ChartApp.ignoredCharts.length||0<ChartApp.limitedCharts.length?"POST":"GET",a={method:e,headers:{"Content-Type":"application/json",Authorization:"Bearer "+App.stk,Docref:document.referrer}};"POST"==e&&(a.body=JSON.stringify({ignoredCharts:ChartApp.ignoredCharts,limitedCharts:ChartApp.limitedCharts})),await fetch("/charts/data/"+t.join(","),a).then(t=>t.json()).then(t=>{for(var e in t.data)App.data[e]=t.data[e];return t.hasOwnProperty("showDateList")&&!App.data.hasOwnProperty("showDateList")&&(App.data.showDateList=t.showDateList),Promise.resolve()}),await new Promise(t=>{setTimeout(function(){ChartApp.drawVisibleCharts(),t()},500)})}},drawVisibleStats:function(t=""){$(t+" .stat-chart").each(function(t,e){var a;void 0===$(e).data("stid")||$(e).hasClass("loaded")||(a=$(e).attr("id"),e=$(e).data("stid"),ChartApp.drawStat(a,e))})},drawVisibleCharts:function(t=""){$(t+" .owl-item.active .chart:not(.loaded),"+t+".chart-theater .chart:visible,"+t+".highlights .chart:visible,"+t+".ready-share .chart:visible,"+t+".chart-list .chart:visible,"+t+".chart-simple .chart:visible,"+t+".chart-item .chart:visible,"+t+".chart-add .chart:visible,"+t+".chart-preview-chart .chart:not(.loaded)").each(function(t,e){var a;void 0===$(e).data("chid")||$(e).hasClass("loaded")||$(e).hasClass("walled")||(a=$(e).attr("id"),e=$(e).data("chid"),"chart"in ChartApp.loggedObj&&ChartApp.loggedObj.chart[e]&&App.data.hasOwnProperty("c:"+e)&&ChartApp.drawChart(a,e))})},drawStat:function(t,e){if(!App.data.hasOwnProperty("s:"+e))return!1;e=App.data["s:"+e];Drawer.drawChart(t,e.info,e.series,!0)},drawChart:function(e,a){if(!App.data.hasOwnProperty("c:"+a)||$("#"+e).hasClass("loaded"))return!1;$("#"+e).removeClass("preloading").addClass("drawing");{let t=ChartApp.logChartView("chart",a);return void t.then(()=>{var t=App.data["c:"+a];Drawer.drawChart(e,t.info,t.series,!0),$("#"+e).removeClass("drawing").addClass("loaded")}).catch(()=>{}).finally(()=>{if(void 0!==window.ccApp&&void 0!==window.ccApp._isVue&&!0===window.ccApp._isVue)try{ccApp.drawnChart()}catch(t){}})}},appendChartWall:function(t,e,a,n,o,r,i){let s=$(t+":not(.walled)");t='<div class="wall chart-wall"> <div class="wall-inner">  <p class="h6 font-weight-bold">'+i+"</p>  <p>"+a+'</p>  <div><a class="btn btn-primary" href="'+n+'" onclick="App.trk4(\''+o+"')\">"+r+"</a></div> </div></div>";s.addClass("walled "+e).append(t)},getChartTitle:function(t,e){let a;return"chart"===t?"c:"+e in App.data&&(a=App.data["c:"+e].info["name_"+App.lang]):"s:"+e in App.data&&(a=App.data["s:"+e]),a},initChartsCarousel:function(){$(".charts-carousel").each(function(t,e){var a=$(this).data("rwd"),n=$(e).attr("id")?"#"+$(e).attr("id")+" ":"",o={items:1,center:!0,nav:!0,navText:['<i class="fal fa-fw fa-angle-left"></i>','<i class="fal fa-fw fa-angle-right"></i>'],onChanged:function(t){0<t.item.count&&setTimeout(function(){var t=$(n+" .owl-item.active .chart:not(.loaded)").attr("id");t&&App.initMod("preload-charts","#"+t)},300)}};void 0!==a&&(delete o.center,o.responsive={0:{items:1},600:{items:3},1e3:{items:5}},o.autoplay=!0),$(e).owlCarousel(o)})},initChartPreview:function(t){var i=[],s=0;$(document).on("click",t+".btn-chart-preview",function(t){i=[],s=0,App.trk4("click_previewchart"),$("#chart-container .chart").each(function(){var t=$(this).data("chid");i.push(t)}),t.preventDefault();var e=$(this).attr("id").split("-")[3];s=i.findIndex(t=>t==e),$("#modal-chart-preview").modal({backdrop:"static"}),ChartApp.chartPreview(e,s,i)}),$(".btn--chart-preview-next, .btn--chart-preview-prev").on("click",function(t){$(this).hasClass("btn--chart-preview-next")?s+=1:$(this).hasClass("btn--chart-preview-prev")&&--s;var e=i[s];App.chartPreview(e,s,i)}),$(".chart-preview-chart-builder").on("click",function(t){var e=i[s];location.href="/toolbox/chart-builder/line?chart="+e}),$(".chart-preview-download").on("click",function(t){App.isUserLoggedIn()?"en"===App.lang||App.isUserPro()?$("#modal-download").modal():alertify.reset().okBtn(App.__("common:btn:start_subscribe")).cancelBtn(App.__("common:btn:cancel")).confirm(App.__("user:logged-in:become-subscriber"),function(t){location.href="/subscribe"},function(t){}):alertify.reset().alert(App.__("user:logged-in:become-subscriber")+App.__("user:login-as-subscriber"))}),$(".chart-preview-exportChart").on("click",function(t){var e=i[s],a="mm-chart-"+App._ts2date(App._now())+"_"+App.data["c:"+e].info["name_"+App.lang],e=$("#cpop-"+e).highcharts();App.trk4("export_chart"),App.doExportChart(e,$("#sel1").val(),a)}),$(".chart-preview-sns").on("click",function(t){t.preventDefault(),t.stopPropagation();var t=$(this).data("type"),e=i[s],a="",n="",o="",r=0;switch("c:"+e in App.data&&(a=App.data["c:"+e].info.slug,n="https://"+location.host+"/charts/"+e+"/"+a,r=null==App.data["c:"+e].info.user?0:App.data["c:"+e].info.user.id),t){case"facebook":o="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(n+"?utm_source=facebook&utm_medium=social&utm_content=share");break;case"linkedin":o="https://www.linkedin.com/cws/share?url="+encodeURIComponent(n+"?utm_source=facebook&utm_medium=social&utm_content=share");break;case"line":o="line://msg/text/"+encodeURIComponent(n+"?utm_source=line&utm_medium=social&utm_content=share");break;case"twitter":o="https://twitter.com/intent/tweet?text="+encodeURIComponent(App.data["c:"+e].info["name_"+App.lang])+"&url="+encodeURIComponent(n+"?utm_source=twitter&utm_medium=social&utm_content=share");break;case"whatsapp":o="whatsapp://send?text="+encodeURIComponent(n+"?utm_source=whatsapp&utm_medium=social&utm_content=share");break;case"telegram":o="https://telegram.me/share/url?text="+encodeURIComponent(n+"?utm_source=telegram&utm_medium=social&utm_content=share")}"copy"==t?$.post("/api/share_url/charts",{obj:{user_id:r,id:e,slug:a}},function(t){1===t.success&&t.url&&($("#copy_url").text(t.url),$("#text-share-copied").addClass("d-none"),$("#btn-share-copy").removeClass("d-none"),$("#chart-preview-share-modal").modal("toggle"))}):window.open(o,"_blank")})},chartPreview:function(t,e,a){$(".modal-chart-preview-paging>.faux-btn").text(e+1+" / "+a.length),$(".chart-preview-chart>.chart").remove(),$(".chart-preview-chart").prepend('<div id="cpop-'+t+'" data-chid="'+t+'" class="chart"></div>'),ChartApp.preloadCharts("#modal-chart-preview "),$(".btn--chart-preview-prev").prop("disabled",0===e),$(".btn--chart-preview-next").prop("disabled",e===a.length-1);var n="",o="";"c:"+t in App.data&&(n=App.data["c:"+t].info["description_"+App.lang],o=App.data["c:"+t].info.slug),setTimeout(function(){""===n||$("#cpop-"+t).hasClass("walled")?$(".chart-preview-sidebar.mm-scrollbar").toggleClass("is-empty"):($(".chart-preview-sidebar.mm-scrollbar").removeClass("is-empty"),$(".chart-preview-sidebar.mm-scrollbar .desc-text").html(n)),$(".chart-preview-chart .chart-page").attr("href",""===o?"/":"/charts/"+t+"/"+o)},50)},doExportChart:function(o,r,i="mm-chart",s=!1){if(!(!o instanceof Highcharts.chart)){let t;-1!==[4,5,6].indexOf(r)?((t=JSON.parse(JSON.stringify(Drawer.exportSettings[r-3]))).chartOptions.series=(()=>{var e={lineWidth:3};let a=[];for(let t=0;t<30;t++)a.push(e);return a})(),6===r&&(t.chartOptions.title.style.fontSize="31px",t.chartOptions.subtitle.style.fontSize="25px",t.chartOptions.legend.itemStyle.fontSize="29px")):delete(t=JSON.parse(JSON.stringify(Drawer.exportSettings[r]))).chartOptions.series;let e=t.exportingOptions,a=t.chartOptions,n=e.sourceWidth+"x"+e.sourceHeight;if(e.filename=i+"-"+n,s){r=o.xAxis[0].categories.length;let t,e;e=r<15?(t="15px","16px"):r<=20?(t="12px","16px"):(t="10px","14px");i=(o.userOptions.plotOptions.hasOwnProperty("column")?o.userOptions.plotOptions.column:o.userOptions.plotOptions.bar).dataLabels.format+("Percent"===o.userOptions.yAxis[0].title?"%":"");a.plotOptions={bar:{dataLabels:{enabled:!0,style:{fontSize:t},format:i}},column:{dataLabels:{enabled:!0,style:{fontSize:t},format:i}}},a.xAxis={labels:{style:{fontSize:e}}}}a=Drawer.appendSourceText(a),o.exportChartLocal(e,a)}},getMultiChartsLogView:function(a,e){if(!Array.isArray(e))return Promise.reject("objIdList is not an array");a in ChartApp.loggedObj||(ChartApp.loggedObj[a]={});let n=[];for(let t=0;t<e.length;t++)e[t]in ChartApp.loggedObj[a]||(n.push(e[t]),ChartApp.loggedObj[a][e[t]]=null);return 0===n.length||fetch("/api/view/"+a+"/"+n.join(","),{method:"POST",headers:{Authorization:"Bearer "+App.stk,Docref:document.referrer}}).then(t=>t.json()).then(t=>{if(1===t.success){if(t.hasOwnProperty("data")&&"object"==typeof t.data)for(var e in t.data)ChartApp.loggedObj[a][e]=t.data[e];t.hasOwnProperty("ignoredCharts")&&Array.isArray(t.ignoredCharts)&&(ChartApp.ignoredCharts=[...new Set(ChartApp.ignoredCharts.concat(t.ignoredCharts))]),t.hasOwnProperty("limitedCharts")&&Array.isArray(t.limitedCharts)&&(ChartApp.limitedCharts=[...new Set(ChartApp.limitedCharts.concat(t.limitedCharts))])}}).catch(t=>Promise.reject(t)),Promise.resolve()},logChartView:async function(a,n){var t=await new Promise(e=>{ChartApp.loggedObj.hasOwnProperty(a)||(ChartApp.loggedObj[a]={}),n in ChartApp.loggedObj[a]&&null!==ChartApp.loggedObj[a][n]?e(ChartApp.loggedObj[a][n]):(ChartApp.loggedObj[a][n]=null,fetch("/api/view/"+a+"/"+n,{method:"POST",headers:{Authorization:"Bearer "+App.stk,Docref:document.referrer}}).then(t=>t.json()).then(t=>{ChartApp.loggedObj[a][n]=t.data[n],t.hasOwnProperty("ignoredCharts")&&Array.isArray(t.ignoredCharts)&&(ChartApp.ignoredCharts=[...new Set(ChartApp.ignoredCharts.concat(t.ignoredCharts))]),t.hasOwnProperty("limitedCharts")&&Array.isArray(t.limitedCharts)&&(ChartApp.limitedCharts=[...new Set(ChartApp.limitedCharts.concat(t.limitedCharts))]),e(t)}))});return ChartApp.showQuotaLimitPopup(t),ChartApp.drawOrBlock(a,n,t)},showQuotaLimitPopup:function(e){if(e.hasOwnProperty("quota_remains")&&null!==e.quota_remains){let t;App.isUserLoggedIn()?10===e.quota_remains&&(t="<p class='text-left px-4 pt-4 pb-2 mb-0'><b class='d-block mb-2'>"+App.__("chart:limit:title")+"</b>"+App.__("chart:limit:normal")+"</p>",App.trk4("chart_limit_subscribe_prompt"),alertify.okBtn(App.__("common:btn:subscribe2")).cancelBtn(App.__("popup:btn:cancel")).confirm(t,function(){App.trk4("chart_limit_subscribe"),location.href="/subscribe"},function(){})):7===e.quota_remains&&(t="<div class='text-right'><button id='alertify-close-btn' class='btn btn-sm btn-default'>X</button></div><p class='text-left px-4 pt-2 mb-0'><b class='d-block mb-2'>"+App.__("chart:limit:title")+"</b>"+App.__("chart:limit:unlogin")+"</p>",$("body").on("click","#alertify-close-btn",function(t){t.preventDefault(),$("div.alertify").remove()}),App.trk4("chart_limit_login_prompt"),alertify.okBtn(App.__("common:btn:subscribe2")).cancelBtn(App.__("common:btn:login2")).confirm(t,function(){App.trk4("chart_limit_login_subscribe"),location.href="/subscribe"},function(){App.trk4("chart_limit_login"),location.href="/login?next="+encodeURIComponent(location.pathname)})),$("p.msg").remove()}},drawOrBlock:function(o,r,i){return new Promise((e,a)=>{var n=ChartApp.getChartTitle(o,r);if("chart"===o){if("boolean"==typeof i.is_sector_blocked&&!0===i.is_sector_blocked)return $(".chart-view-btn-"+r).addClass("disabled"),t=App.isUserLoggedIn()?"/subscribe":"/login?next="+encodeURIComponent(location.pathname),ChartApp.appendChartWall('.chart[data-chid="'+r+'"]',"walled-mbr",App.__("chart:blocked:msg:"+i.block),t,"chart_micro",App.__("btn:subscribe-now"),n),void a();if("boolean"!=typeof i.chart_views_exceeded||!0!==i.chart_views_exceeded||i.docref_allowed)e();else if($("body").hasClass("page-index")||$("body").hasClass("page-macro-home"))e();else if(i.hasOwnProperty("go_pro")&&0<i.go_pro){App.trk4("chart_subscribe_prompt");let t=App.__("user:pls-subscribe:charts2");2===i.go_pro&&(t=App.__("user:subscriber-only-content")),($("body").hasClass("page-bookmarks")||$("body").hasClass("page-chart-collection"))&&i.is_allow_chart?e():(ChartApp.appendChartWall('.chart[data-chid="'+r+'"]',"walled-pro",t,"/subscribe","chart_subscribe",App.__("btn:subscribe-now"),n),a())}else{App.trk4("chart_login_prompt");var t=App.__("user:pls-login");$("body").hasClass("page-industries")?(ChartApp.appendChartWall('.chart[data-chid="'+r+'"]',"walled-mbr",t,"/login?next="+encodeURIComponent(location.pathname),"chart_login",App.__("common:btn:sign-up-log-in"),n),ChartApp.appendChartWall(".quote-container","walled-mbr",t,"/login?next="+encodeURIComponent(location.pathname),"chart_login",App.__("common:btn:sign-up-log-in"),n)):ChartApp.appendChartWall('.chart[data-chid="'+r+'"]',"walled-mbr",t,"/login?next="+encodeURIComponent(location.pathname),"chart_login",App.__("common:btn:sign-up-log-in"),n),a()}}else e()})}};function html5localStorage(){try{return localStorage.setItem("__z","z"),localStorage.removeItem("__z"),!0}catch(t){return!1}}$.fn.StatSelector=function(t){return t=$.extend(!0,{width:"100%",theme:"bootstrap",placeholder:this.attr("placeholder"),ajax:{url:"/source/stat",method:"POST",dataType:"json",delay:250,data:function(t){return{search:t.term,id:"",slug:"",country:"",name:"",category:"",category_parent:""}},processResults:function(t){return t.forEach(function(t){t.text=t.name}),{results:t}},cache:!0},escapeMarkup:function(t){return t}},t),this.select2(t)};var App={conf:{is_phone:void 0!==window.matchMedia&&window.matchMedia("(max-width: 767px)").matches,months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],cacheable:html5localStorage(),cache_root:"mm.",history_api:!(!window.history||!history.pushState),re:{email:/^([^\s@]+@[^\s@]+\.[a-zA-Z]{2,})$/,date:/^(19|20)[0-9]{2}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/,device_mobile:/^\/[A-Z0-9\-\.\+]{7}$/,device_cert:/^[A-Z]{2}[0-9]{14}$/,bad:/[\u0000-\u001F\u007F\u0080-\u009F.,!?;:\-()[\]{}"'\<>\u3000]/g}},data:{iv:{}},init:function(){void 0!==window.alertify&&alertify.theme("bootstrap"),App.initMod("nav"),App.initMod("notification-toggler"),App.initMod("banners"),App.initMod("luv"),App.initMod("lazyload"),App.initMod("svg"),App.initMod("ts2human"),App.initMod("paging"),App.initMod("floatables"),App.initMod("data-trk"),App.initMod("data-trk4"),App.initMod("chart-preview"),0<$(".fb-like").length&&App.initMod("fb-lib"),App.conf.is_phone||$('[data-toggle="tooltip"]').tooltip(),setInterval(function(){App.keepalive()},1e3*App._rand(120,150)),setTimeout(function(){App.keepalive()},1e3*App._rand(3,5)),document.documentElement.style.setProperty("--scrollbar-width",Math.max(window.innerWidth-document.body.clientWidth,0)+"px")},isUserLoggedIn:function(){return $("body").hasClass("is-user")},isUserPro:function(){return App.isUserLoggedIn()&&(0<$("header .dropdown-menu--user .mm-pro").length||0<$("header .dropdown-menu--user .mm-prime").length||0<$("header .dropdown-menu--user .mm-max").length)},isUserPrime:function(){return App.isUserLoggedIn()&&(0<$("header .dropdown-menu--user .mm-prime").length||0<$("header .dropdown-menu--user .mm-max").length)},isUserBiz:function(){return App.isUserLoggedIn()&&0<$("header .dropdown-menu--user .mm-biz").length},isUserMax:function(){return App.isUserLoggedIn()&&0<$("header .dropdown-menu--user .mm-max").length},isProTeamParent:function(){return App.isUserLoggedIn()&&App.isUserPro()&&0<$("header .dropdown-menu--user .mm-team-parent").length},isProTeamChild:function(){return App.isUserLoggedIn()&&App.isUserPro()&&0<$("header .dropdown-menu--user .mm-team-children").length},initFB:function(){"undefined"!=typeof FB_ready&&(!1!==FB_ready?(FB.Event.subscribe("comment.create",App.FB.commentCreatedCb),FB.Event.subscribe("comment.remove",App.FB.commentRemovedCb),setTimeout(function(){App.initMod("load-visible-fb-page")},3e3)):setTimeout(App.initFB,1e3))},countStat:function(t){ChartApp.countStat(t)},getCdnResizedImageUrl(t="",e="width=640,quality=70"){return""!==t&&window.hasOwnProperty("CDN_ROOT")?t.replace(window.CDN_ROOT,window.CDN_ROOT+"/cdn-cgi/image/"+e):t},initMod:function(l,t){switch("string"!=typeof t&&(t=""),l){case"nav":$(".navbar .dropdown").on("show.bs.dropdown",function(){var t;$(".dropdown-menu",this).addClass("fadeInUp").show(),1===$(".dropdown-menu input.autofocus-on-show",this).length&&(t=$(".dropdown-menu input.autofocus-on-show",this),setTimeout(function(){t.focus()},250))}).on("hidden.bs.dropdown",function(){$(".dropdown-menu",this).removeClass("fadeInUp").hide()});var e=new Slideout({panel:document.getElementById("panel"),menu:document.getElementById("menu"),padding:300,tolerance:70,side:"right",touch:!1});function d(t){t.preventDefault(),e.close()}e.on("beforeopen",function(){this.panel.classList.add("panel-open")}).on("open",function(){this.panel.addEventListener("click",d)}).on("beforeclose",function(){this.panel.classList.remove("panel-open"),this.panel.removeEventListener("click",d)}),$(".btn--menu-toggler").on("click",function(t){t.preventDefault(),e.toggle()}),$("#menu .item-sub").hide(),$("#menu .item-sub--toggler").on("click",function(t){t.preventDefault(),t.stopPropagation(),$(this).toggleClass("on");t=$(this).data("target");$("#menu "+t).toggle({duration:300})}),$('#menu a[href^="#"]').on("click",function(t){t.preventDefault();t=$(this).attr("href");$(t).trigger("click")}),setTimeout(function(){$("#menu .item-sub--toggler.default-on").trigger("click")},100);break;case"notification-toggler":$(".navbar .btn--notifications").on("click",function(t){t.preventDefault(),App.notifications.show()}),$("#modal-notification-center").on("change",'.chkbox input[type="checkbox"]',function(t){var e=$(this).prop("checked"),a=$(this).prop("value"),n=$(this).closest(".list-group-item");e&&(n.addClass("off").prop("disabled",!0),App.notifications.open([a]))}).on("click","#btn-notification-center-openall",function(t){var a=[];$('#modal-notification-center .chkbox input[type="checkbox"]:enabled').each(function(t,e){a.push($(e).val()),$(e).prop("checked",!0)}),0<a.length&&App.notifications.open(a)}),App.notifications.init();break;case"quickie-preload-charts":ChartApp.preloadQuickieCharts(t);break;case"preload-stats":ChartApp.preloadStats(t);break;case"preload-charts":ChartApp.preloadCharts(t);break;case"charts-carousels":ChartApp.initChartsCarousel();break;case"draw-visible-stats":ChartApp.drawVisibleStats(t);break;case"draw-visible-charts":ChartApp.drawVisibleCharts(t);break;case"luv":App.conf.is_phone||$("[data-luv]:not(.on)").tooltip();var a,i=null,s="",p="",c=null;$(document).on("click",t+".luv",function(t){var e="."+$(this).attr("class").split(" ").join("."),e=(c=document.querySelector(e),JSON.parse(c.dataset.luv));console.log("luvObj",e),!$(this).hasClass("disabled")&&App.isUserLoggedIn()?(s=".luv-"+(i=e).obj+"-"+i.id,a=i.liked?"unlike":"like",p="/api/"+a+"/"+i.obj+"/"+i.id,"unlike"==a?alertify.reset().okBtn(App.__("common:btn:sure")).cancelBtn(App.__("common:btn:cancel")).confirm(App.__("bookmarks:unlike"),function(t){App.luvData(p,s,i,[],c)},function(t){}):"chart"==i.obj&&"like"==a?$.get("/api/collections/"+i.id,function(t){if(0<t.data.length){for(var e=[],a=0,n=t.data.length;a<n;a++){var o=t.data[a],r=!App.isUserPro()&&4<a?"disabled":o.add?"checked":"",o='<li class="list-group-item"><div class="tbl"><div class="tbl-cell">'+App._escapeHtml(o.name)+'</div><div class="tbl-cell chkbox"><input type="checkbox" name="collections[]" value="'+o.id+'" '+r+"></div></div></li>";e.push(o)}$("#modal-bookmark-collection .list-group").html(e.join("")),$("#modal-bookmark-collection").modal("show")}else App.luvData(p,s,i,[],c)}):App.luvData(p,s,i,[],c)):alertify.reset().okBtn(App.__("common:btn:sure")).alert(App.__("user:pls-login"),function(t){App.trk4("prompt_login",{Campaign:"btn_bookmark",url:location.pathname}),location.href="/login?next="+location.pathname})}),$("#modal-bookmark-collection").on("click","#btn-bookmark-collection-select",function(t){var a=[];$('#modal-bookmark-collection .chkbox input[type="checkbox"]:checked').each(function(t,e){a.push($(e).val())}),App.luvData(p,s,i,a,c)});break;case"chart-like":ChartApp.likeCharts(t);break;case"lazyload":new LazyLoad({elements_selector:".lazy"});break;case"svg":$("[data-mmsvg]:not(.mmsvg-loaded)").each(function(t,e){$(e).load("https://cdn.macromicro.me"+$(e).data("mmsvg")).addClass("mmsvg-loaded")});break;case"ts2human":$(t+'.ts[data-ts!=""]').each(function(t,e){var a=$(e).data("ts"),n=$(e).data("format");$(e).text(App._ts2human(a,n)).attr("title",App._ts2human(a))});break;case"banners":1==$("section.banners").length&&1==$("section.banners .banners-carousel").length&&(1<$("section.banners .banners-carousel .banner--item").length&&$("section.banners .banners-carousel").owlCarousel({items:1,margin:0,lazyLoad:!0,lazyLoadEager:1,loop:!0,autoplay:!0,autoplayTimeout:1e4}),$("section.banners .banners-carousel a.overlay").on("click",function(t){t.preventDefault();var e=$(this),t=parseInt(e.data("bid"),10);App.trk4("banner",{Campaign:"banner-"+t,url:e.attr("href")}),e.addClass("clicked"),setTimeout(function(){location.href=e.prop("href")},300)}));break;case"paging":$("[data-paging]").on("click",function(t){t.preventDefault();var a=$(this),n=a.data("paging");alertify.reset().okBtn(App.__("common:btn:sure")).cancelBtn(App.__("common:btn:cancel")).prompt(App.__("common:prompt:paging",{"{pages}":n.total_pages}),function(t,e){t=parseInt(t,10);1<=t&&t<=n.total_pages&&t!=n.page&&(location.href=a.prop("href").replace(/page=([0-9]+)/,"page="+t))})});break;case"fb-lib":var n;0==$("#fb-root").length&&($("body").prepend('<div id="#fb-root"></div>'),n="zh_TW",$("body").hasClass("lang-sc")&&(n="zh_CN"),$("body").hasClass("lang-en")&&(n="en_US"),window.FB_ready=!1,window.fbAsyncInit=function(){window.FB.init({appId:"159315044413885",xfbml:!0,version:"v7.0"}),window.FB_ready=!0},r=document,o="facebook-jssdk",u=r.getElementsByTagName("script")[0],r.getElementById(o)||((r=r.createElement("script")).id=o,r.async="true",r.defer="true",r.crossorigin="anonymous",r.src="https://connect.facebook.net/"+n+"/sdk.js",u.parentNode.insertBefore(r,u)));break;case"floatables":$(".floatables .btn--gotop").on("click",function(){App.trk4("btn-gotop"),$("html,body").animate({scrollTop:0},500)});var o=Cookies.get("app_ui_support_btn"),h="https://support.macromicro.me/hc/zh-tw";"sc"==App.lang&&(h="https://support.macromicro.me/hc/zh-cn"),"en"==App.lang&&(h="https://support.macromicro.me/hc/en-001"),!App.conf.is_phone&&(void 0===o||parseInt(o,10)<5)?($(".floatables .btn--newbie").on("click",function(){App.trk4("btn-newbie"),Cookies.set("app_ui_support_btn",App._now(),{path:"/",expires:30}),window.open(h,"_blank")}),$(".floatables .btn--newbie-close").on("click",function(){App.trk4("btn-newbie-close"),Cookies.set("app_ui_support_btn",App._now(),{path:"/",expires:30}),$(".floatables .btn--newbie, .floatables .btn--newbie-close").remove()}),o=void 0===o?1:parseInt(o,10)+1,Cookies.set("app_ui_support_btn",o,{path:"/"})):$(".floatables .btn--newbie, .floatables .btn--newbie-close").remove(),window.onscroll=function(){var t=$(".floatables .btn--gotop").hasClass("on"),e=Math.min(window.innerHeight,500)||500,a=document.documentElement.scrollTop||document.body.scrollTop;!t&&e<=a?$(".floatables .btn--gotop, .floatables .btn--newbie, .floatables .btn--newbie-close").addClass("on"):t&&a<e&&$(".floatables .btn--gotop, .floatables .btn--newbie, .floatables .btn--newbie-close").removeClass("on")};break;case"data-trk":$(document).on("click","[data-trk]",function(t){var e=$(this).data("trk");App.trk(e.cat,e.act,e.lab,e.val)});break;case"data-trk4":$(document).on("click","[data-trk4]",function(t){var e=$(this).data("trk4");App.trk4(e.evt,e.payload)});break;case"chart-preview":ChartApp.initChartPreview(t)}var r,o,u},chartPreview:function(t,e,a){ChartApp.chartPreview(t,e,a)},luvData:function(t,a,n,e=[],o){$.get(e.length?t+"?ids="+e.toString(","):t,function(t){if(!t||1!=t.success||void 0===t.data){if(0==t.success&&void 0!==t.error)switch(t.error){case 401:alertify.reset().okBtn(App.__("common:btn:sure")).alert(t.msg,function(t){location.href="/login?next="+location.pathname});break;case 403:t.next?alertify.reset().okBtn(App.__("common:btn:start_subscribe")).cancelBtn(App.__("common:btn:cancel")).confirm(t.msg,function(t){App.trk4("bookmarks_charts_subscribe"),location.href="/subscribe"},function(t){}):alertify.reset().okBtn(App.__("common:btn:sure")).alert(t.msg)}return null}var e=$("#booked-"+t.data.id);e.length||(e=$(a+" .cnt")),1==t.data.liked?($(a).data("luv",t.data).removeClass("off").addClass("on"),e.html(parseInt(e.html())+1),App.trk4("add_favorite_"+n.obj)):($(a).data("luv",t.data).removeClass("on").addClass("off"),e.html(parseInt(e.html())-1)),o.dataset.luv=JSON.stringify(t.data),t.addToC&&alertify.reset().okBtn(App.__("common:btn:sure")).alert(App.__("common:modal-bookmark-collection:success")),"chart"!=n.obj&&"collection"!=n.obj&&"discussion"!=n.obj&&"question"!=n.obj||!window.vm||"function"!=typeof window.vm.luvToggled||window.vm.luvToggled(t.data)},"json")},getStatData:function(t){ChartApp.getStatData(t)},getChartData:async function(t){await ChartApp.getChartData(t)},goTop:function(t,e){var a=0,n="number"==typeof e?e:0;"string"==typeof t&&1==$(t).length&&(a=$(t).offset().top+1),setTimeout(function(){$("html,body").animate({scrollTop:a+n+"px"},300)},100)},logChartView:async function(t,e){await ChartApp.logChartView(t,e)},logView:function(t,e){$.ajax("/api/view/"+t+"/"+e,{method:"POST",data:{t:App._now()},success:function(t){},headers:{Authorization:"Bearer "+App.stk,Docref:document.referrer},dataType:"json"})},getChartTitle:function(t,e){return ChartApp.getChartTitle(t,e)},appendChartWall:function(t,e,a,n,o,r,i){ChartApp.appendChartWall(t,e,a,n,o,r,i)},drawStat:function(t,e){ChartApp.drawStat(t,e)},drawChart:function(t,e){ChartApp.drawChart(t,e)},FB:{commentCreatedCb:function(t){$.post("/charts/sync-comments",t,function(){},"json")},commentRemovedCb:function(t){$.post("/charts/sync-comments",t,function(){},"json")}},_now:function(){return Math.round((new Date).getTime()/1e3)},_ts2date:function(t){t=new Date(1e3*t);return t.getFullYear()+"-"+App._pad0(t.getMonth()+1,2)+"-"+App._pad0(t.getDate(),2)},_ts2time:function(t){t=new Date(1e3*t);return App._pad0(t.getHours(),2)+":"+App._pad0(t.getMinutes(),2)+":"+App._pad0(t.getSeconds(),2)},_ts2human:function(t,e){var a=new Date(1e3*t),n=a.getFullYear(),o=a.getMonth()+1,r=(App._pad0(o,2),App.conf.months[a.getMonth()]),i=a.getDate(),s=(App._pad0(i,2),App._pad0(a.getHours(),2)),p=App._pad0(a.getMinutes(),2);switch(e){case"n/j H:i":return o+"/"+i+" "+s+":"+p;case"j M H:i":return i+" "+r+" "+s+":"+p;case"j M Y":return i+" "+r+" "+n;case"H:i":return s+":"+p;case"smart":var l=App._now(),d=(new Date).getFullYear(),c=l-t;switch(!0){case c<60:return"now";case c<3600:return Math.floor(c/60)+"m";case c<86400:return Math.floor(c/3600)+"h";case c<604800:return Math.floor(c/86400)+"d";case d==n:return App._ts2human(t,"j M H:i");default:return App._ts2human(t,"j M Y")}break;default:return a.getDate()+" "+App.conf.months[a.getMonth()]+" "+n+", "+s+":"+p}},_parseDate:function(t){var t=t.split("-"),e=parseInt(t[0]),a=parseInt(t[1],10)-1,t=parseInt(t[2]);return Date.UTC(e,a,t)},_date2label:function(t,e){var a=t.split("-")[0],o=t.split("-")[1];t.split("-")[2];switch(!0){case"Y"==e:return a;case"Q"==e:return n=parseInt(o,10),a+" Q"+(Math.floor(n/3)+1);case"M"==e:return a+"-"+o;default:return t}},isDateValid:function(t){return App.conf.re.date.test(t)},isUrlValid:function(t){try{return Boolean(new URL(t))}catch(t){return!1}},sec2hmi:function(t){if(!t||t<=0)return"00:00";var e=Math.floor(t/3600),a=Math.floor((t-3600*e)/60),t=t-3600*e-60*a;return(0<e?e+":":"")+App._pad0(a,2)+":"+App._pad0(t,2)},_pad0:function(t,e){for(var a=""+t;a.length<e;)a="0"+a;return a},_nl2br:function(t){return t.replace(/\n/g,"<br>")},_escapeHtml:function(t){var e=document.createElement("div");return e.appendChild(document.createTextNode(t)),e.innerHTML},_decodeEntities:function(t){return t.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/amp;/g,"")},_rand:function(t,e){e-=t;return t+Math.round(Math.random()*e)},_chance:function(t){return Math.random()<t},_numberFormat:function(t,e,a,n){return numberFormat(t,e,a,n)},_full2half:function(t){return t.replace(/[０-９，]/g,function(t){return String.fromCharCode(t.charCodeAt(0)-65248)})},pv:function(t){App.trk4("page_view",{page_location:t})},trk:function(t,e,a,n){App.trk4(t+"__"+e)},trk4:function(t,e){try{(e="object"!=typeof e?{}:e).send_to=window.GA4_ID,gtag("event",t,e)}catch(t){}},_isArray:function(t){return"[object Array]"===Object.prototype.toString.apply(t)},_log:function(t){if("undefined"!=typeof console&&console.log)try{console.log(t)}catch(t){}},_showModal:function(t){$(".overlay,.mmodal"+t).removeClass("off"),$(".mmodal"+t).addClass("fadeInDown animated"),$("body").addClass("noscroll")},_hideModal:function(t){$(".overlay").addClass("off"),$(".mmodal"+t).removeClass("fadeInDown animated").addClass("off"),$("body").removeClass("noscroll")},keepalive:function(){if(App.conf.cacheable){var t=App.cache.get("keepingalive"),e=App.cache.get("keptalive"),a=App.cache.get("csrf");if(null!=t&&App._now()-t<3)return;if(null!=e&&App._now()-e<30)return void(null!=a&&1==$("#csrf-token").length&&a!=$("#csrf-token").attr("content")&&($('input[name="csrf"]').val(a),$("#csrf-token").attr("content",a)));App.cache.set("keepingalive",App._now())}$.post("/api/keepalive",{},function(t){"string"==typeof t.csrf&&($('input[name="csrf"]').val(t.csrf),$("#csrf-token").attr("content",t.csrf)),void 0!==t.notifications&&App.notifications.process(t.notifications),App.conf.cacheable&&(App.cache.set("csrf",t.csrf),App.cache.set("keptalive",t.ts))},"json"),App.initMod("ts2human")},notifications:{data:[],icons:{1:"comment-dots",2:"bullhorn",4:"exclamation-square"},data_str:"",unopened_cnt:0,updated:0,init:function(){var t=App._now()-300;App.conf.cacheable&&App.cache.get("notifications_cached")>t&&(t=App.cache.get("notifications"),App.notifications.process(t)),$("#modal-notification-center .list-group").on("click","a[href]",function(t){var e;$(this).closest(".list-group-item").hasClass("off")||(t.preventDefault(),$(this).fadeTo(300,.2),t=$(this).data("nid"),e=$(this).prop("href"),App.notifications.open([t]),setTimeout(function(){location.href=e},800))})},process:function(t){var e=JSON.stringify(t),a=0;if(0==App.notifications.updated||e!=App.notifications.data_str){App.notifications.data=t,App.notifications.data_str=e,App.notifications.updated=App._now();for(var n=0,o=t.length;n<o;n++)null==t[n].opened&&a++;App.notifications.unopened_cnt=a,$(".navbar .btn--notifications").removeClass("on off pulsing").addClass(0<a?"on pulsing":"off"),App.conf.cacheable&&(App.cache.set("notifications",t),App.cache.set("notifications_cached",App._now()))}$("#btn-notification-center-openall").prop("disabled",0==App.notifications.unopened_cnt)},getHtml:function(){for(var t=App.notifications.data,e=[],a=0,n=t.length;a<n;a++){var o=t[a],r="string"==typeof App.notifications.icons[o.icon]?App.notifications.icons[o.icon]:"exclamation-square",r='<li class="list-group-item '+(o.opened?"off":"")+'"><div class="tbl"><div class="tbl-cell"><a href="'+o.url+'" data-nid="'+o.id+'"><i class="fal fa--blt fa-fw fa-'+r+'"></i>'+App._escapeHtml(o.msg)+'</a><div class="meta">'+App._ts2human(o.sended)+'</div></div><div class="tbl-cell chkbox"><input type="checkbox" name="notifications[]" value="'+o.id+'" '+(o.opened?"checked disabled":"")+"></div></div></li>";e.push(r)}return e.join("")},open:function(t){$.post("/api/notifications/open/"+t.join("-"),{t:App._now()},function(t){void 0!==t.notifications&&App.notifications.process(t.notifications)},"json"),App.trk4("click_notification")},show:function(){0!=App.notifications.data.length&&($("#modal-notification-center .list-group").html(App.notifications.getHtml),$("#modal-notification-center").modal("show"),$(".navbar .btn--notifications").removeClass("pulsing"),App.trk4("notification"))}},doPost:function(t,e){var n=$("<form></form>");n.attr("method","post"),n.attr("action",t),$.each(e,function(t,e){var a=$("<input />");a.attr("type","hidden"),a.attr("name",t),a.attr("value",e),n.append(a)}),$(document.body).append(n),n.submit()},alertMsgOrNext:function(e){"string"==typeof e.msg&&""!=e.msg?alertify.reset().okBtn(App.__("common:btn:sure")).cancelBtn(App.__("common:btn:cancel")).alert(e.msg,function(t){"string"==typeof e.next&&""!=e.next&&("string"==typeof e.target&&""!=e.target?window.open(e.next,e.target):location.href=e.next)}):"number"==typeof e.reload&&1==e.reload?location.reload(!0):"string"==typeof e.next&&""!=e.next&&("string"==typeof e.target&&""!=e.target?window.open(e.next,e.target):location.href=e.next)},validator:{isValidUBN:function(t){if(0==/^\d{8}$/.test(t)||-1!="00000000,11111111".indexOf(t))return!1;for(var e,a,n=[1,2,1,2,1,2,4,1],o=0,r=0;r<n.length;r++)o+=(e=t[r]*n[r],a=void 0,(a=e%10)+(e-a)/10);return o%5==0||"7"==t[6]&&(o+1)%5==0}},__:function(){var t=Array.prototype.slice.call(arguments);if(0==t.length)return null;var e=t[0],a=null;if(void 0===LANG[e]||"string"!=typeof LANG[e])return null;if(null!=(a=LANG[e])&&2<=t.length&&"object"==typeof t[1]){var n,o=t[1];for(n in o)a=a.replace(n,o[n])}return a},doExportChart:function(t,e,a="mm-chart",n=!1){ChartApp.doExportChart(t,e,a,n)},isUserSubscribing:function(e=!1,t="/subscribe",a="toolbox_subscribe",n=8e3){if(!App.isUserLoggedIn()){let t="/login?next="+encodeURIComponent(location.pathname+location.search);return alertify.alert(App.__("user:subscriber-only-content:unlogin"),function(){location.href=t}),e||setTimeout(function(){location.href=t},n),!1}if(App.isUserPro())return!0;var n=App.__("user:logged-in:become-subscriber"),o=App.__("common:btn:subscribe");return alertify.reset().okBtn(o).cancelBtn(App.__("common:btn:cancel")).confirm(n,function(){"string"==typeof a&&0<a.length&&App.trk4(a),location.href=t},function(){e||(location.href=t)}),e||setTimeout(function(){location.href=t},8e3),!1},checkUserLevel:function(e=!1,t="/toolbox/chart-builder/line",a="toolbox_subscribe",n=8e3){if(!App.isUserLoggedIn()){let t="/login?next="+encodeURIComponent(location.pathname+location.search);return alertify.alert(App.__("user:prime-only-content:unlogin"),function(){location.href=t}),e||setTimeout(function(){location.href=t},n),!1}if(App.isUserPrime())return!0;let o,r;return o=App.isUserPro()?(r=App.__("common:btn:upgrade"),App.__("user:prime-only-content:pro")):(r=App.__("common:btn:subscribe"),App.__("user:prime-only-content:normal")),alertify.reset().okBtn(r).cancelBtn(App.__("common:btn:cancel")).confirm(o,function(){"string"==typeof a&&0<a.length&&App.trk4(a),location.href="/user/upgrade/y/prime"},function(){e||(location.href=t)}),e||setTimeout(function(){location.href=t},8e3),!1},getDateByRange:function(t){let e=new Date;switch(t){case"1w":e.setDate(e.getDate()-7);break;case"1m":e.setMonth(e.getMonth()-1);break;case"3m":e.setMonth(e.getMonth()-3);break;case"6m":e.setMonth(e.getMonth()-6);break;case"ytd":e.setMonth(0),e.setDate(1);break;case"1y":e.setFullYear(e.getFullYear()-1);break;case"2y":e.setFullYear(e.getFullYear()-2);break;case"3y":e.setFullYear(e.getFullYear()-3);break;case"5y":e.setFullYear(e.getFullYear()-5);break;case"10y":e.setFullYear(e.getFullYear()-10)}return e.toLocaleDateString("sv")},cache:{get:function(t){return null!=localStorage.getItem(App.conf.cache_root+t)?JSON.parse(localStorage.getItem(App.conf.cache_root+t)):null},set:function(t,e){localStorage.setItem(App.conf.cache_root+t,JSON.stringify(e))},del:function(t){localStorage.removeItem(App.conf.cache_root+t)}}};App.stk=$(".footer p[data-stk]").data("stk"),$(App.init);